{% extends "accounts_main.html" %}
{% set active_tab = 'profile' %}
{% block tab_content %}

<div class="profile-content">
    <div class="profile-info">
        <div class="info-row">
            <span class="info-label">Name:</span>
            <span class="info-value">{{ user.name }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Email ID:</span>
            <span class="info-value">{{ user.email }}</span>
        </div>
    </div>

    <div class="profile-actions">
        <button id="delete-user-btn" class="btn btn-danger">Delete User</button>
        <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Logout</a>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.getElementById('delete-user-btn').addEventListener('click', function() {
    let warningMessage = 'Are you sure you want to delete your account? All data associated with your account will be deleted from our system. This action cannot be undone.';
    
    {% if user.is_sole_admin %}
    warningMessage += ' Additionally, as you are the sole admin for some organizations, those organizations will also be deleted.';
    {% endif %}

    if (confirm(warningMessage)) {
        fetch("{{ url_for('accounts.delete_user') }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = "{{ url_for('auth.logout') }}";
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while deleting your account.');
        });
    }
});
</script>
{% endblock %}